<dc.Html Badges="SysAdmin" NoCache="true">
	<Meta Name="Title">
		<Tr Locale="eng" Value="Step 0" />
	</Meta>

	<dcdb.LoadRecord Table="dcTaskList" Id="{$Page.OriginalPathParts.3}" Result="StepData">
		<Select Field="dcReviewStatus" As="Status" />
		<Select Field="dcReviewMessage" As="Message" />
		<Select Field="dcApprovedAt" As="ApprovedAt" />
	</dcdb.LoadRecord>

	<dc.Body>
		<dc.PagePanel>
			<p>
				Step 0: {$StepData.Status}
			</p>

			<dcf.FormButtons>
				<dc.Button Label="Done 0" Click="DoReindex" />
			</dcf.FormButtons>
		</dc.PagePanel>
	</dc.Body>

	<Function Name="Load"><![CDATA[
			var page = this;

	]]></Function>
	<Function Name="DoReindex"><![CDATA[
			var page = this;

			dc.comm.call('dcCoreServices.TaskList.UpdateReview', {
				Id: '{$Page.OriginalPathParts.3}',
				Status: 'Passed',
				Approved: true
			}, function(rmsg) {
				if (rmsg.Code > 0) {
					dc.pui.Popup.alert('Unable to update step: ' + rmsg.Message);
				}
				else {
					page.Layer.refreshPage();
				}
			});

	]]></Function>
</dc.Html>
