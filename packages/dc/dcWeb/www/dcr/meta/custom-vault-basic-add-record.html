<dc.Html Badges="User">
	<Meta Name="Title">
		<Tr Locale="eng" Value="Add Record" />
	</Meta>

	<Require Script="/js/vendor/speakingurl-5.0.1.min.js" />

	<dc.Body>
		<dc.PagePanel>
			<dcf.Form Name="AddFolder">
				<dcf.Text Name="Title" Label="Title" DataType="dcmPageTitle" Required="true" />
				<dcf.Text Name="Alias" Label="Slug Name" Required="true" Pattern="[\w-]+"
					placeholder="no spaces - use dash instead of space" />
				<dcf.TextArea Name="Description" Label="Description" Required="true" />

					<dcf.FormButtons>
						<dcf.SubmitButton Label="Add" />
					</dcf.FormButtons>
			</dcf.Form>
		</dc.PagePanel>
	</dc.Body>
	<Function Name="Load"><![CDATA[
			var page = this;

			page.form().inputQuery('Title')
				.focusout(function(e) {
					var slug = page.form().getValue('Alias');

					if (! slug) {
						slug = getSlug(page.form().getValue('Title'));
						page.form().setValue('Alias', slug);
					}
				})
				.focus();

			if (this.Params.Vault)
				page.Store.Vault = this.Params.Vault;
			else
				page.Store.Vault = 'Files';

			page.Store.Path = null;
	]]></Function>
	<Function Name="LoadRecord" Params="e"><![CDATA[
			e.AsNew = true;
			e.Data = {
				Path: ''
			};
	]]></Function>
	<Function Name="SaveRecord" Params="e"><![CDATA[
			var page = this;

			if (e.Data.Alias.indexOf('/') != 0)
				e.Data.Alias = '/' + e.Data.Alias + '.json';

			if (page.Params.Path && (page.Params.Path != '/'))
				e.Data.Path = page.Params.Path + e.Data.Alias;
			else
				e.Data.Path = e.Data.Alias;

			page.Store.Path = e.Data.Path;

			e.Message = {
				Op: 'dcmServices.Meta.AddCustomVaultDataFile',
				Body: {
					Alias: page.Store.Vault,
					Path: page.Store.Path,
					Form: {
						Title: e.Data.Title,
						Description: e.Data.Description
					}
				}
			};
	]]></Function>
	<Function Name="AfterSave"><![CDATA[
			var page = this;

			page.Layer.back();

			if (page.Params.Callback)
				page.Params.Callback( [
					{
						Path: page.Store.Path
					}
				] );
	]]></Function>
	<Function Name="AfterCancel"><![CDATA[
			var page = this;

			page.Layer.back();
	]]></Function>
</dc.Html>
