<dc.Html>
	<Meta Name="Title">
		<Tr Locale="en" Value="Sign In" />
	</Meta>

	<dc.Body>
		<dc.PagePanel>
			<dcf.Form Name="SignIn">
				<dcf.Text Name="Username" Label="Email" placeholder="email or username" Required="true" />
				<dcf.Password Name="Password" Label="Password" Required="true" />
				<dcf.YesNo Label="Remember Me" Name="RememberMe" />

				<dcf.FormButtons>
					<dc.Button Label="Reset Password" Click="onRecover" />
					<dc.Button Label="Cancel" Click="onCancel" />
					<dcf.SubmitButton Label="Sign In" />
				</dcf.FormButtons>
			</dcf.Form>
		</dc.PagePanel>
	</dc.Body>
	<Function Name="onCancel">
				this.Layer.back();
	</Function>
	<Function Name="onRecover">
				this.Layer.loadPage('/dcw/user/reset.html');
	</Function>
	<Function Name="LoadRecord" Params="e">
				var info = dc.user.getUserInfo();

				if (info.Credentials) {
					e.Data = $.extend(true, { RememberMe: info.RememberMe }, info.Credentials);
					this.form().query('Password').focus();
				}
				else {
					this.form().query('Username').focus();
				}
	</Function>
	<Function Name="AfterSave" Params="e">
				var entry = this;

				var values = this.form().getValues();

				dc.user.signin(values.Username, values.Password, values.RememberMe, function(msg) {
					if (dc.user.isVerified()) {
						entry.Layer.back();

						if (entry.Params.Callback)
							entry.Params.Callback();
						else
							window.location.reload();
					}
					else {
						dc.pui.Popup.alert('Invalid sign in');
					}
				});
	</Function>
</dc.Html>
