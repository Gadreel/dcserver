<dc.Html>
	<dcs.With Target="$_Resources.Config">
		<GetTag Path="Users" Result="UserConfig" />
	</dcs.With>

	<Meta Name="Title">
		<Tr Locale="eng" Value="Sign In" />
	</Meta>

	<dc.Body>
		<dc.PagePanel>
			<dcf.Form Name="SignIn">
				<dcf.Text Name="Username" Label="Username" placeholder="username" Required="true" />
				<dcf.Password Name="Password" Label="Password" Required="true" />

				<dcs.If Target="$UserConfig.@SignInRemember" Equal="true">
					<dc.Out>
						<dcf.YesNo Label="Remember Me" Name="RememberMe" />
					</dc.Out>
				</dcs.If>

				<dcf.FormButtons>
					<dcs.If Target="$UserConfig.@SignUpEnabled" Equal="true">
						<dc.Out>
							<dc.Button Label="Sign Up for Account" Click="onSignUp" />
						</dc.Out>
					</dcs.If>
					<dc.Button Label="Reset Password" Click="onRecover" />
					<dc.Button Label="Cancel" Click="onCancel" />
					<dcf.SubmitButton Label="Sign In" />
				</dcf.FormButtons>
			</dcf.Form>
		</dc.PagePanel>
	</dc.Body>
	<Function Name="Load"><![CDATA[
			var page = this;

	]]></Function>
	<Function Name="onCancel"><![CDATA[
				this.Layer.back();
	]]></Function>
	<Function Name="onRecover"><![CDATA[
				this.Layer.back();

				this.Layer.loadPage('/dcw/user/reset.html');
	]]></Function>
	<Function Name="onSignUp"><![CDATA[
				this.Layer.back();

				this.Layer.loadPage('/dcw/user/sign-up.html');
	]]></Function>
	<Function Name="LoadRecord" Params="e"><![CDATA[
				var entry = this;

				var info = dc.user.loadRemembered();

				if (info) {
					e.Data = $.extend(true, { RememberMe: true }, info);
				}
	]]></Function>
	<Function Name="AfterSave" Params="e"><![CDATA[
				var entry = this;

				var values = this.form().getValues();

				dc.user.signin(values.Username, values.Password, values.RememberMe, function(msg) {
					if (dc.user.isVerified()) {
						entry.Layer.back();

						if (entry.Params.Callback)
							entry.Params.Callback();
						else
							window.location.reload(true);
					}
					else {
						dc.pui.Popup.alert('Invalid sign in');
					}
				});
	]]></Function>
</dc.Html>
