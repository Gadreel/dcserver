<dc.Html Badges="Admin,Editor">
	<Meta Name="Title">
		<Tr Locale="eng" Value="Carousel Widget Properties" />
	</Meta>

	<dc.Body>
		<dc.PagePanel>
			<dcf.Form>
				<dcf.FormButtons Hint="form options">
					<dcf.SubmitButton Label="Save" />
				</dcf.FormButtons>

				<dcf.Text Name="Title" Label="Title" />
				<dcf.Text
					Name="Gallery"
					Label="Path"
					Required="true"
					placeholder="use Show selector below - include leading /"
				>
					<Instructions>
						<Tr>
Must select a show (see below) that already exists. If you don't have a show saved, go make it first.
						</Tr>
					</Instructions>
				</dcf.Text>
				<dcf.Text
					Name="Show"
					Label="Show"
					Required="true"
				>
					<Input />
					<Button Icon="fa-ellipsis-h" Click="DoSelectShow" />
				</dcf.Text>
				<!-- TODO review
				<dcf.Text Name="Max" Label="Max" placeholder="if set, will show only the top N images (N = Max)" />
				<dcf.Text Name="ListId" Label="List Id" />
				<dcf.Text Name="Lang" Label="Language" placeholder="blank for default - es = Spanish, en = English, etc" />
				<dcf.YesNo Name="Hidden" Label="Hidden" />
				-->
				<dcf.Text Name="Class" Label="CSS Classes" placeholder="custom styling for this section" />
			</dcf.Form>
		</dc.PagePanel>
	</dc.Body>
	<Function Name="Load"><![CDATA[
			var entry = this;

			entry.Store.Params = dc.pui.App.Context.Params;
    ]]></Function>
	<Function Name="LoadRecord" Params="e"><![CDATA[
			var entry = this;

			e.Message = {
				Service: 'dcCoreServices',
				Feature: 'Vaults',
				Op: 'Custom',
				Body: {
					Vault: 'Feeds',
					Command: 'LoadPart',
					Path: '/' + entry.Store.Params.Feed + entry.Store.Params.Path,
					Params: {
						PartId: entry.Store.Params.Id
					}
				}
			};

			if (dc.handler.dcmVersion == '2018') {
				e.Message = {
					Service: 'dcmServices',
					Feature: 'Feed',
					Op: 'LoadPart',
					Body: {
						Feed: entry.Store.Params.Feed,
						Path: entry.Store.Params.Path,
						PartId: entry.Store.Params.Id
					}
				};
			}
    ]]></Function>
	<Function Name="AfterLoadRecord" Params="e"><![CDATA[
			var entry = this;

			var widget = entry.Store.Params.Widget = (dc.handler.dcmVersion == '2018') ? e.Data.Part : e.Data.Extra;

			var attrs = entry.Store.Params.Content = widget.attributes;

			if (! attrs)
				attrs = { };

			e.Data = {
				Title: attrs.Title ? attrs.Title : '',
				Gallery: attrs.Gallery ? attrs.Gallery : '',
				Show: attrs.Show ? attrs.Show : '',
				Class: attrs.class ? attrs.class : ''
			};
	]]></Function>
	<Function Name="SaveRecord" Params="e"><![CDATA[
			var entry = this;

			var widget = entry.Store.Params.Widget;

			if (! widget.attributes)
				widget.attributes = { };

			if (e.Data.hasOwnProperty('Class'))
				widget.attributes['class'] = e.Data.Class;

			if (e.Data.hasOwnProperty('Path'))
				widget.attributes['Path'] = e.Data.Path;

			if (e.Data.hasOwnProperty('Variant'))
				widget.attributes['Variant'] = e.Data.Variant;

			e.Message = {
				Service: 'dcCoreServices',
				Feature: 'Vaults',
				Op: 'Custom',
				Body: {
					Vault: 'Feeds',
					Command: 'SavePart',
					Path: '/' + entry.Store.Params.Feed + entry.Store.Params.Path,
					Params: {
						PartId: entry.Store.Params.Id,
						Part: widget
					}
				}
			};

			if (dc.handler.dcmVersion == '2018') {
				e.Message = {
					Service: 'dcmServices',
					Feature: 'Feed',
					Op: 'AddCommandHistory',
					Body: {
						Feed: entry.Store.Params.Feed,
						Path: entry.Store.Params.Path,
						Commands: [
							{
								Command: 'SavePart',
								Params: {
									PartId: entry.Store.Params.Id,
									Part: widget
								}
							}
						]
					}
				};
			}

    ]]></Function>
	<Function Name="AfterSave"><![CDATA[
			dc.pui.Popup.alert('Saved');
	]]></Function>
	<Function Name="DoSelectShow"><![CDATA[
			var entry = this;

		    dc.pui.Dialog.loadPage('/dcm/cms/galleries/ShowChooser', {
				Callback: function(res) {
					if (res.Shows && res.Shows.length) {
						var fh = res.Shows[0];

						entry.form().setValue('Gallery', fh.Path);
						entry.form().setValue('Show', fh.Show);
					}
				}
			});
    ]]></Function>
</dc.Html>
